{{define "body"}}
<h1>Manage User - {{.TargetUsername}}</h1>
<h3>SSH Keys</h3>
<button onclick="document.getElementById('add-ssh-key-dialog').showModal()">
    Add New SSH Key &#128931;
</button>
<br />
<br />
<table>
    <tbody>
        {{range $index, $sshKey := .SshKeys}}
        <tr>
            <td>{{$sshKey}}</td>
            <td>
                <button onclick="deleteSshKeyLine({{$index}}+1)">
                    Delete SSH Key &#128465;
                </button>
            </td>
        </tr>
        {{end}}
    </tbody>
</table>
<br />
<dialog id="add-ssh-key-dialog">
    <div style="display: grid; grid-auto-flow: column">
        <div>
            <h3>Add New SSH Key</h3>
        </div>
        <div>
            <span
                class="close-button"
                onclick="document.getElementById('add-ssh-key-dialog').close()"
            >&#128938;</span>
        </div>
    </div>
    <form id="add-ssh-key-form">
        <label for="addSshKey">SSH Key:</label>
        <input
            type="text"
            id="addSshKey"
            name="sshKey"
            maxlength="256"
            placeholder="Enter SSH Key"
            required="required"
            autocomplete="off"
        />
        <br />
        <br />
        <input
            type="submit"
            value="Add SSH Key"
        />
    </form>
</dialog>
<script>
    document.getElementById("add-ssh-key-form").addEventListener("submit", function (event) {
        event.preventDefault();
        if (confirm("Are you sure you want to add this SSH Key?")) {
            document.getElementById("add-ssh-key-dialog").close();
            toggleLoading();
            fetch("/api/user/{{.TargetUsername}}/ssh-key", { method: "POST", body: new FormData(this) }).then((response) => {
                if (response.ok) {
                    location.reload();
                } else {
                    response.text().then((text) => displayNotification(text));
                    toggleLoading();
                }
            });
        }
    });

    function deleteSshKeyLine(lineNumber) {
        if (confirm("Are you sure you want to delete this SSH Key?")) {
            toggleLoading();
            fetch(`/api/user/{{.TargetUsername}}/ssh-key/${lineNumber}`, { method: "DELETE" }).then((response) => {
                if (response.ok) {
                    location.reload();
                } else {
                    response.text().then((text) => displayNotification(text));
                    toggleLoading();
                }
            });
        }
    }
</script>
{{end}}